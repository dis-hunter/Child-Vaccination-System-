<?php
session_start();
require 'C:\xampp\htdocs\PHPMailer\src\PHPMailer.php';
require 'C:\xampp\htdocs\PHPMailer\src\SMTP.php';
require 'C:\xampp\htdocs\PHPMailer\src\Exception.php';
// require 'C:\xampp\htdocs\PHPMailer\src\OAuth.php';
require 'vendor\autoload.php';

require 'vendor/autoload.php';

use PHPMailer\PHPMailer\PHPMailer;
use PHPMailer\PHPMailer\SMTP;
use PHPMailer\PHPMailer\Exception;

class SendMail {
    private $mailer;
    
    public function __construct() {
        $this->mailer = new PHPMailer(true);
        
        // Configure SMTP settings
        $this->mailer->isSMTP();
        $this->mailer->Host = 'smtp.gmail.com';
        $this->mailer->SMTPAuth = true;
        $this->mailer->Username = 'tobikoleriari69@gmail.com';
        $this->mailer->Password = 'belo gjrh yrsl hyxr';
        $this->mailer->SMTPSecure = PHPMailer::ENCRYPTION_SMTPS; // Changed to SMTPS for port 465
        $this->mailer->Port = 465;
        
        // Set default sender
        $this->mailer->setFrom('tobikoleriari69@gmail.com', 'Tobiko Leriari');
        
        // Enable HTML emails by default
        $this->mailer->isHTML(true);
    }
    
    public function sendMail($recipients, $subject, $body) {
        if (!is_array($recipients)) {
            $recipients = [$recipients];
        }
        
        $results = [];
        
        try {
            foreach ($recipients as $recipient) {
                $this->mailer->addAddress($recipient);
                $this->mailer->Subject = $subject;
                $this->mailer->Body = $body;
                
                if ($this->mailer->send()) {
                    $results[$recipient] = "Mail sent successfully";
                } else {
                    $results[$recipient] = "Failed to send mail";
                }
                
                $this->mailer->clearAddresses();
            }
            
            return $results;
            
        } catch (Exception $e) {
            throw new Exception("Message could not be sent. Mailer Error: {$this->mailer->ErrorInfo}");
        }
    }
}

// Usage example:
try {
    $mailer = new SendMail();
    
    $recipients = [
        'tobikoleriari@gmail.com',
        'peter.leriari@strathmore.edu',
        'giftgichuhi4138@gmail.com'
    ];
    
    $subject = "KINGA BORA TEST";
    $body = "This is a test email";
    

    $results = $mailer->sendMail($recipients, $subject, $body);
    
    foreach ($results as $recipient => $status) {
        echo "Recipient: $recipient - Status: $status<br>";
    }
    
} catch (Exception $e) {
    echo "Error: " . $e->getMessage();
}