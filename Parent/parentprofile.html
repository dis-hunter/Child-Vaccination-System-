<!DOCTYPE html>
<html>
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile Page</title>
  <!-- <script src="../Header-Footer/header-footer.js"></script> -->
  <link rel="stylesheet" href="../Header-Footer/Stylesheets/style.css">
  <style>
    body {
  font-family: sans-serif;
  margin: 0;
  padding: 20px;
}

/* Header */
.profile-header {
  display: flex;
  align-items: center;  /* Vertically align items */
  padding: 20px;
  background-color: #40e0d0;
  border-radius: 8px;
  margin: 4%;
}

.profile-pic {
  width: 100px;
  height: 100px;
  border-radius: 50%;
  margin-right: 20px;
}

.profile-info {
  flex-grow: 1;  /* Allow profile info to take up available space */
}

.profile-actions button {
  margin-left: 10px; 
  padding: 8px 12px;
  background-color: #008080; /* Example blue color */
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

/* Skills Section */
.children ul {
  list-style: none;
  padding-left:10px;
  display: flex;  /* Arrange skills horizontally */
  flex-wrap: wrap; /* Allow wrapping to next line */
}

.children li {
  margin: 5px;
  padding: 8px 12px;
  background-color: #f5f5f5;
  border-radius: 4px;
}

/* Updates Section */
.updates {
  margin-top: 20px;
}

.update {
  background-color: #fff;
  padding: 15px;
  margin-bottom: 10px;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.update p {
  margin-bottom: 5px;
}

.update button {
  /* ... similar styling as profile-actions buttons ... */
}
  </style>
</head>
<body>
    <special-header></special-header>
    <main>
 
    <div class="profile-header">
      <!-- <img src="profile-picture.jpg" alt="Profile Picture" class="profile-pic"> -->
      <div class="profile-info">
        <h1>Oloisudori Lemayan</h1>
        <p>Parent</p>
        <p>South B, Nairobi</p>
      </div>
      <div class="profile-actions">
        <button>Edit Profile</button>
        <button>Settings</button>
      </div>
    </div>
    <form class="d-flex" role="search" onsubmit="searchBar(); return false;">
      <input class="form-control me-2" type="search" id="searchQuery" placeholder="Enter Parent Name" aria-label="Search">
      <button class="btn btn-outline-success" type="submit">Search</button>
  </form>
  
  
  </div>

  
    <section class="children">
      <h1>Children</h1>
      <a id="childname" href="#">Child Name (Document ID)</a>

      <ul>
        <li>Zawadi</li>
        <li>{{data.childName}}</li>
        <li>Taiyo</li>
      </ul>
    </section>

    <section class="updates">
      
      <div class="update">
        <h2>Messages</h2>
        <p>Receive latest results and reminders on vaccinations to come!</p>
      </div>
      
    </section>
  </main>
  <special-footer></special-footer>

</body>
</html>
<script>
 document.querySelector("form").addEventListener("submit", function(event) {
    event.preventDefault(); // Prevent form from submitting and reloading the page
    searchBar();  // Call your async function
  });

  async function searchBar() {
    const storedLocalId = localStorage.getItem('localId');
    console.log("Stored Local ID:", storedLocalId);

    const parentName = document.getElementById('searchQuery').value;  // Get the parent name from the input field
    console.log(parentName);

    try {
      // Define the API URL and include the ParentName as a query parameter
      const url = `http://127.0.0.1:5000/childDetails?ParentName=${encodeURIComponent(parentName)}`;

      // Send a GET request to the backend
      const response = await fetch(url, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',  // You can keep headers if needed
        }
      });

      // Process the response
      const data = await response.json();

      if (response.ok) {
        console.log('Children found:', data);  // Log child names in the console
        
        // Call a function to update the DOM with the list of children
        displayChildren(data.children); // Assuming the children are in `data.children`
      } else {
        console.error('Error fetching child details:', data.error || response.statusText);
      }
    } catch (error) {
      console.error('Error:', error);
    }
  }

  // Function to dynamically update the DOM with the children- not yet donee
  function displayChildren(children) {
    const childrenList = document.querySelector('.children ul');
    childrenList.innerHTML = '';  // Clear the list first

    // Loop through the children array and create list items for each child
    children.forEach(child => {
      const listItem = document.createElement('li');
      listItem.textContent = child.ChildName;  // Assuming each child object has a 'ChildName' property
      childrenList.appendChild(listItem);
    });
  }
async function ParentDetails() {    
  
  parent_localId=getParentDetails()

  try {
    // Define the API URL and include the ParentName as a query parameter
    const url = `http://127.0.0.1:5000/childDetails?ParentName=${encodeURIComponent(parentName)}`;

    // Send a GET request to the backend (no body needed for GET requests)
    const response = await fetch(url, {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',  // You can keep headers if needed
      }
    });

    // Process the response
    const data = await response.json();

    if (response.ok) {
      console.log('Children found:', data);  // Log child names in the console
    } else {
      console.error('Error fetching child details:', data.error || response.statusText);    }
  } catch (error) {
    console.error('Error:', error);
  }
}
async function getParentDetails()
{


    // Extract the localId
    const localId = getLocalIdFromUrl();
    
    if (!localId) {
        console.error("localId not found in URL");
        return; // Exit the function if localId is not found
    }
    console.log("parent localID",localId);
    return localId;
}
function getLocalIdFromUrl() {                              //gets the local id from the url
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('localId'); // Change 'localId' to whatever the parameter name is
    }

    
    
    async function getParentsChildren() {
  // Await the result of getParentDetails to ensure parent_localId is not a promise
  const parent_localId = await getParentDetails();

  // Check if parent_localId is valid
  if (!parent_localId) {
    console.error("Parent local ID not found.");
    return;
  }

  try {
    const url = `http://127.0.0.1:5000/parentDetails?ParentlocalID=${encodeURIComponent(parent_localId)}`;
    const response = await fetch(url, { method: 'GET' });
    const data = await response.json();

    if (response.ok) {
      console.log('Parent found:', data);

      // Example of handling child profile link
      const child = data.childNames[0]; // Assuming there's only one child for simplicity
      const childName = child.ChildName;
      const childDocId = child.id; // Access the document ID

      const childProfileLink = document.getElementById("childname");
      childProfileLink.href = `vaccinationpage.html?localId=${childDocId}`;
      childProfileLink.textContent = `${childName} (${childDocId})`;
    } else {
      console.error('Error fetching child details:', data.error || response.statusText);
    }
  } catch (error) {
    console.error('Error:', error);
  }
}


document.addEventListener('DOMContentLoaded', () => {
  getParentsChildren();  // Call the function when the DOM is fully loaded
});


</script>
