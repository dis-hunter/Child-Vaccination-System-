<?php
session_start();
require 'C:\xampp\htdocs\PHPMailer\src\PHPMailer.php';
require 'C:\xampp\htdocs\PHPMailer\src\SMTP.php';
require 'C:\xampp\htdocs\PHPMailer\src\Exception.php';
// require 'C:\xampp\htdocs\PHPMailer\src\OAuth.php';
require 'vendor\autoload.php';


//Import PHPMailer classes into the global namespace
use PHPMailer\PHPMailer\PHPMailer;
use PHPMailer\PHPMailer\SMTP;
use PHPMailer\PHPMailer\Exception;

class sendMail{

    public function sendMail($recipients, $subject, $body){
        $mail = new PHPMailer(true);
        try{
            $mail->isSMTP();
            $mail->Host = 'smtp.gmail.com';
            $mail->SMTPAuth = true;
            $mail->Username ='tobikoleriari69@gmail.com';
            $mail->Password ='belo gjrh yrsl hyxr';
            $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
            $mail->Port = 465;

            $mail->setFrom('tobikoleriari69@gmail.com', 'Tobiko Leriari');

            foreach($recipients as $recipients){
                $mail->addAddress($recipients);
                $mail->isHTML(true);
                $mail->Subject = $subject;
                $mail->Body =$body;

                if($mail->send()){
                    echo 'Mail sent to {$recipient} successfully';
            } else{
                echo 'Mail not sent';
            }
            $mail->clearAddresses();
            }
        }catch(Exception $e){
            echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
        }
    }
   
}
$recipients = [
    'tobikoleriari@gmail.com',
    'peter.leriari@strathmore.edu',
    'giftgichuhi4138@gmail.com'
];
$subject="KINGA BORA TEST";
$body="This is a test email";